# XX教学管理系统

这不是一个完整的XX系统，它只是描述了一个业务系统大致的基本架构设计，同时本次核心目标是通过 Rust 的结构体和枚举等基本数据结构来描述本系统的核心业务主体和主体之间的业务关系，但是并不过于去关注太多具体业务的字段细节。

目标：

- 可通过 docker compose 一键启动完整运行服务，包括数据库
- 可通过 OpenAPI 标准接口文档实时查看服务 API 接口设计，并可执行调试操作
- 实现分层架构的业务层函数声明和服务层的函数声明
- 通过 ER 图描述最核心部分的业务主体关系

不做的：

- 业务层和服务层的具体业务逻辑代码实现
- 不涉及更为实际情况的业务细节和数据场景

## 运行

1. 启动数据库和缓存，包括：

- pgsql（Postgres 数据库）
- pgadmin4（pg 的管理界面）
- redis（缓存）
- lesson03（本次课程服务，目前还未成功在容器编译，所以暂先使用本机运行）

```sh
docker compose up -d
```

2. 从本机运行服务（此为开发环境即 DEBUG 模式）

```sh
cargo run --bin lesson03
```

3. 查看服务接口文档：http://localhost:8000/api/rapidoc

> 数据库默认超级用户 postgres 密码 postgres
>
> 默认数据库为 postgres
>
> 目前是没有数据表的，需要手动创建，建表 sql 在 lesson03/src/sql/table.sql
>
> 缓存 redis 无密码，且重启后数据会全部消失，但目前还未真正使用到 redis 缓存

4. 连接数据库

5. 执行数据表创建 lesson03/src/sql/table.sql
6. 通过接口文档界面执行“添加学员”
7. 通过接口文档界面执行“查询学员列表”

这样就基本跑通这个服务了！

⚠️ 目前所有代码均仅为学习使用，未为生产环境进行优化适配，请勿直接用于生产环境。

## 业务说明

核心主体关系可参考 lesson03.jpg 这张 ER 图。

核心主体目前包括：

- 学员
- 教师
- 课程
- 班级
- 任课
- 配课
- 上课
- 考试
- 成绩

并不会全部实现全部接口声明，仅声明部分以满足演示即可。

## 备注

- 代码架构为分层架构（biz-svc），名字是我自取的，其设计模式类似于六边形架构或干净架构，但稍微比它们更为简洁紧凑。
- 其特点是具体的业务逻辑的实现，它上层与API框架隔离，下层与具体数据库服务对接隔离，如果需要更换框架，业务逻辑代码是完全不动的。
- biz 和 svc 它们所直接管理的代码皆为无状态函数设计，自身基本上不携带任何隐藏的影响业务逻辑的内部变量，它们的核心目的就是支撑实现整个业务逻辑的调用组合。
- 这种编码风格为自创，目前没有见到第二家，最早由我在整理前公司核心业务多个 Python 代码仓库执行全项目大规模重构时形成，所以这种架构设计非常善于帮助进行大规模重构、切换框架、切换数据库服务、切换第三方服务、切换语言（特别是从 Python 切换到 Rust）。
- 目前选用 Rocket 的原因是与它配合的库目前能很好地全自动呈现 OpenAPI 文档，定义好数据结构和声明 API 接口之后，再无任何多余工作。
- 这是我见过的所有语言所有框架中，包括 Python Java Golang，它们都无法实现的全自动超精细最准确绝对实时的 OpenAPI 接口文档，但在 Rust 这里可以实现，足以表明 Rust 超级强大的数据结构描述能力。

